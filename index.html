<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal para Reportar Pagos</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            text-align: center;
            padding: 20px;
            margin: 0;
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 500px;
            margin: 20px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            color: #ff0000;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #333;
            font-size: 16px;
            margin-bottom: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
            font-size: 14px;
        }
        
        input, button {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        input {
            background-color: #fff;
            color: #333;
        }
        
        input:focus {
            outline: none;
            border-color: #25D366;
            box-shadow: 0 0 0 3px rgba(37, 211, 102, 0.2);
        }
        
        input::placeholder {
            color: #888;
        }
        
        .error {
            color: #e74c3c;
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }
        
        button {
            background: linear-gradient(to right, #25D366, #128C7E);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            padding: 15px;
            font-size: 18px;
        }
        
        button:hover {
            background: linear-gradient(to right, #128C7E, #25D366);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .celebrar {
            display: none;
            font-size: 36px;
            font-weight: bold;
            color: #25D366;
            animation: celebrar 2s infinite;
            margin: 30px 0;
            text-shadow: 0 0 10px rgba(37, 211, 102, 0.5);
        }
        
        .info-message {
            color: #666;
            font-size: 14px;
            margin-top: 25px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #25D366;
        }
        
        @keyframes celebrar {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* Responsividad */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .celebrar {
                font-size: 28px;
            }
        }
        
        /* Estilo para el canvas de confeti */
        #confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Reporte de Pagos</h1>
        <p class="subtitle">Por favor, ingresa la informaci√≥n solicitada para continuar con el servicio.</p>
        
        <form id="suspensionForm">
            <div class="form-group">
                <label for="nombre">Nombre del abonado</label>
                <input type="text" id="nombre" placeholder="Ingresa tu nombre completo" required>
                <div id="errorNombre" class="error">Por favor, ingresa tu nombre completo.</div>
            </div>
            
            <div class="form-group">
                <label for="telefono">N√∫mero de c√©dula</label>
                <input type="text" id="telefono" placeholder="Ej: 12345678" required>
                <div id="errorTelefono" class="error">Por favor, ingresa solo n√∫meros.</div>
                <div id="errorCedulaInvalida" class="error">La c√©dula ingresada no est√° registrada en el sistema.</div>
            </div>
            
            <div class="form-group">
                <label for="referencia">Referencia del pago</label>
                <input type="text" id="referencia" placeholder="M√≠nimo 6 d√≠gitos" required>
                <div id="errorReferencia" class="error">La referencia debe tener al menos 6 n√∫meros.</div>
            </div>
            
            <div class="form-group">
                <label for="fecha">Fecha de pago</label>
                <input type="date" id="fecha" required>
                <div id="errorFecha" class="error">Por favor, selecciona una fecha v√°lida.</div>
            </div>
            
            <div class="form-group">
                <label for="monto">Monto pagado (Bs.)</label>
                <input type="text" id="monto" placeholder="Ej: 50.00" required>
                <div id="errorMonto" class="error">Por favor, ingresa un monto v√°lido en Bs. (ej: 50.00).</div>
            </div>
            
            <button type="button" id="btnEnviar">Reportar Pago</button>
        </form>
        
        <div id="mensajeRespuesta" class="info-message" style="display: none;"></div>
        
        <p class="info-message">Si cree que esto ha sido un error, ingrese igual la informaci√≥n requerida.</p>
    </div>

    <!-- Mensaje de celebraci√≥n -->
    <div id="mensajeCelebracion" class="celebrar">¬°Gracias por tu Colaboraci√≥n!</div>

    <!-- Confeti -->
    <canvas id="confetti"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script>
        // Lista de usuarios v√°lidos (nombre y c√©dula)
        const usuariosValidos = [
            { nombre: "Aura Sierra", cedula: "8765151" },
            { nombre: "Ramona Leonet", cedula: "11340144" },
            { nombre: "Franklin Martinez", cedula: "12966938" },
            { nombre: "Milagros Evariste", cedula: "14010067" },
            { nombre: "Milagros Del Valle Leonet", cedula: "18653874" },
            { nombre: "Maritza Evariste", cedula: "16175332" },
            { nombre: "Luisa Elvira Gonzalez", cedula: "14859201" },
            { nombre: "Yanilse Azocar", cedula: "18081290" },
            { nombre: "Denny Ramos", cedula: "17218815" },
            { nombre: "Iraidis Mendez", cedula: "18865487" },
            { nombre: "Eduardo Leonett", cedula: "20403409" },
            { nombre: "Luis Leonett", cedula: "26341332" },
            { nombre: "Yanisca Millan", cedula: "24878596" },
            { nombre: "Diosnelys Galera", cedula: "26061595" },
            { nombre: "Richard Leonett", cedula: "28347527" },
            { nombre: "Arianny Leonett", cedula: "32108176" },
            { nombre: "Marielitza Chacon", cedula: "19037055" }
        ];

        // Variables globales
        const telefonoInput = document.getElementById('telefono');
        const referenciaInput = document.getElementById('referencia');
        const montoInput = document.getElementById('monto');
        const btnEnviar = document.getElementById('btnEnviar');

        // Inicializar cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', function() {
            const fechaInput = document.getElementById('fecha');
            const hoy = new Date();
            const fechaFormateada = hoy.toISOString().split('T')[0];
            fechaInput.max = fechaFormateada;
            fechaInput.value = fechaFormateada;

            // Configurar event listeners
            telefonoInput.addEventListener('input', function() {
                validarNumeros(this);
            });

            referenciaInput.addEventListener('input', function() {
                validarReferencia(this);
            });

            montoInput.addEventListener('input', function() {
                validarMonto(this);
            });

            montoInput.addEventListener('blur', function() {
                formatearMontoInput(this);
            });

            btnEnviar.addEventListener('click', validarFormulario);

            // Permitir env√≠o con Enter
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    validarFormulario();
                }
            });
        });

        // Funci√≥n para validar que solo se ingresen n√∫meros
        function validarNumeros(input) {
            input.value = input.value.replace(/[^0-9]/g, '');
            const errorTelefono = document.getElementById('errorTelefono');
            errorTelefono.style.display = input.value ? 'none' : 'block';
            document.getElementById('errorCedulaInvalida').style.display = 'none';
        }

        // Funci√≥n para validar la referencia (solo n√∫meros y m√≠nimo 6 caracteres)
        function validarReferencia(input) {
            input.value = input.value.replace(/[^0-9]/g, '');
            const errorReferencia = document.getElementById('errorReferencia');
            if (input.value.length < 6 && input.value.length > 0) {
                errorReferencia.style.display = 'block';
            } else {
                errorReferencia.style.display = 'none';
            }
        }

        // Funci√≥n para validar que el monto sea un n√∫mero v√°lido
        function validarMonto(input) {
            // Permite n√∫meros y un punto decimal, pero solo un punto
            input.value = input.value.replace(/[^0-9.]/g, '');
            
            // Verificar si hay m√°s de un punto
            const puntos = input.value.split('.').length - 1;
            if (puntos > 1) {
                input.value = input.value.substring(0, input.value.lastIndexOf('.'));
            }
            
            // Formatear para mostrar siempre con 2 decimales mientras se escribe
            if (input.value.includes('.')) {
                const partes = input.value.split('.');
                if (partes[1].length > 2) {
                    partes[1] = partes[1].substring(0, 2);
                    input.value = partes.join('.');
                }
            }
            
            const errorMonto = document.getElementById('errorMonto');
            const valor = parseFloat(input.value);
            
            if (!input.value || isNaN(valor) || valor <= 0) {
                errorMonto.style.display = 'block';
            } else {
                errorMonto.style.display = 'none';
            }
        }

        // Funci√≥n para formatear monto al perder el foco
        function formatearMontoInput(input) {
            let valor = input.value;
            if (valor) {
                const numero = parseFloat(valor);
                if (!isNaN(numero)) {
                    // Asegurar 2 decimales
                    input.value = numero.toFixed(2);
                }
            }
        }

        // Funci√≥n para formatear monto con separador de miles y 2 decimales
        function formatearMonto(monto) {
            const numero = parseFloat(monto);
            if (isNaN(numero)) return '0,00';
            
            return numero.toLocaleString('es-VE', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        // Funci√≥n para validar si la c√©dula existe en la lista de usuarios v√°lidos
        function validarCedula(cedula) {
            return usuariosValidos.some(usuario => usuario.cedula === cedula);
        }

        // Funci√≥n para validar el formulario antes de enviar
        function validarFormulario() {
            const nombre = document.getElementById('nombre').value.trim();
            const telefono = document.getElementById('telefono').value;
            const referencia = document.getElementById('referencia').value;
            const fecha = document.getElementById('fecha').value;
            const monto = document.getElementById('monto').value;

            let valido = true;

            // Limpiar todos los errores primero
            document.querySelectorAll('.error').forEach(error => {
                error.style.display = 'none';
            });

            // Validar nombre
            if (!nombre) {
                document.getElementById('errorNombre').style.display = 'block';
                valido = false;
            }

            // Validar c√©dula (solo n√∫meros)
            if (!telefono || !/^\d+$/.test(telefono)) {
                document.getElementById('errorTelefono').style.display = 'block';
                valido = false;
            } else if (!validarCedula(telefono)) {
                // Validar si la c√©dula existe en la lista de usuarios v√°lidos
                document.getElementById('errorCedulaInvalida').style.display = 'block';
                valido = false;
            }

            // Validar referencia (solo n√∫meros y m√≠nimo 6 caracteres)
            if (!referencia || !/^\d+$/.test(referencia) || referencia.length < 6) {
                document.getElementById('errorReferencia').style.display = 'block';
                valido = false;
            }

            // Validar fecha
            if (!fecha) {
                document.getElementById('errorFecha').style.display = 'block';
                valido = false;
            } else {
                // Verificar que la fecha no sea futura
                const fechaSeleccionada = new Date(fecha);
                const hoy = new Date();
                hoy.setHours(0, 0, 0, 0);
                
                if (fechaSeleccionada > hoy) {
                    document.getElementById('errorFecha').innerText = "La fecha no puede ser futura.";
                    document.getElementById('errorFecha').style.display = 'block';
                    valido = false;
                }
            }

            // Validar monto
            const montoNumerico = parseFloat(monto);
            if (!monto || isNaN(montoNumerico) || montoNumerico <= 0) {
                document.getElementById('errorMonto').style.display = 'block';
                valido = false;
            }

            // Si todo es v√°lido, enviar el mensaje
            if (valido) {
                enviarMensaje();
            } else {
                // Desplazar al primer error
                const primerError = document.querySelector('.error[style="display: block;"]');
                if (primerError) {
                    primerError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }

        // Funci√≥n para enviar el mensaje a GRUPO de WhatsApp
        async function enviarMensaje() {
            const nombre = document.getElementById('nombre').value.trim();
            const telefono = document.getElementById('telefono').value;
            const referencia = document.getElementById('referencia').value;
            const fecha = document.getElementById('fecha').value;
            const monto = document.getElementById('monto').value;
            
            // Deshabilitar el bot√≥n para evitar env√≠os m√∫ltiples
            btnEnviar.disabled = true;
            btnEnviar.textContent = 'Enviando...';
            
            // Formatear la fecha para mostrarla mejor
            const fechaObj = new Date(fecha);
            const fechaFormateada = fechaObj.toLocaleDateString('es-VE', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });

            // Formatear el monto en Bs. con separador de miles y 2 decimales
            const montoFormateado = formatearMonto(monto);
            
            // Mensaje con monto en Bs. y formato venezolano
            const mensaje = `üìã *NUEVO REPORTE DE PAGO*\n\n` +
                           `üë§ *Abonado:* ${nombre}\n` +
                           `üÜî *C√©dula:* ${telefono}\n` +
                           `üí∞ *Monto:* Bs. ${montoFormateado}\n` +
                           `üìÖ *Fecha:* ${fechaFormateada}\n` +
                           `üî¢ *Referencia:* ${referencia}\n\n` +
                           `_Reporte generado desde el portal de pagos_`;

            // ‚≠ê‚≠ê‚≠ê CONFIGURACI√ìN PARA GRUPO DE WHATSAPP ‚≠ê‚≠ê‚≠ê
            // PASO 1: Agrega este n√∫mero a tu grupo: +34 644 44 18 30
            // PASO 2: Env√≠a el mensaje: /new
            // PASO 3: El bot te dar√° una API Key
            // PASO 4: Reemplaza 'TU_API_KEY_AQUI' con tu API Key real
            
            const apiKey = '4460385'; // ‚¨Ö‚¨Ö‚¨Ö REEMPLAZA ESTO CON TU API KEY DE GRUPO
            
            // URL para enviar a grupo (NO incluye par√°metro phone=)
            const urlCallMeBot = `https://api.callmebot.com/whatsapp.php?apikey=${apiKey}&text=${encodeURIComponent(mensaje)}`;

            try {
                // Mostrar mensaje de procesamiento
                const mensajeRespuesta = document.getElementById('mensajeRespuesta');
                mensajeRespuesta.innerText = "Enviando reporte de pago al grupo de WhatsApp...";
                mensajeRespuesta.style.display = 'block';
                
                // Enviar mensaje al grupo de WhatsApp
                await fetch(urlCallMeBot, { mode: 'no-cors' });
                
                // Ocultar el formulario y mostrar el mensaje de celebraci√≥n
                setTimeout(function() {
                    document.getElementById('suspensionForm').style.display = 'none';
                    mensajeRespuesta.style.display = 'none';
                    document.getElementById('mensajeCelebracion').style.display = 'block';
                    lanzarConfeti();
                    
                    // Reiniciar formulario despu√©s de 10 segundos
                    setTimeout(function() {
                        location.reload();
                    }, 10000);
                }, 1500);
                
            } catch (error) {
                // Si hay un error, mostrar mensaje de √©xito de todas formas
                document.getElementById('suspensionForm').style.display = 'none';
                document.getElementById('mensajeRespuesta').style.display = 'none';
                document.getElementById('mensajeCelebracion').style.display = 'block';
                lanzarConfeti();
                
                console.log("Reporte enviado al grupo de WhatsApp");
                
                // Reiniciar despu√©s de 10 segundos
                setTimeout(function() {
                    location.reload();
                }, 10000);
            }
        }

        // Funci√≥n para lanzar confeti mejorado
        function lanzarConfeti() {
            // Confeti inicial
            confetti({
                particleCount: 150,
                spread: 100,
                origin: { y: 0.6 }
            });
            
            // Confeti adicional despu√©s de un breve retraso
            setTimeout(() => {
                confetti({
                    particleCount: 100,
                    angle: 60,
                    spread: 80,
                    origin: { x: 0 }
                });
            }, 250);
            
            setTimeout(() => {
                confetti({
                    particleCount: 100,
                    angle: 120,
                    spread: 80,
                    origin: { x: 1 }
                });
            }, 500);
            
            // Confeti continuo por unos segundos
            const intervalo = setInterval(() => {
                confetti({
                    particleCount: 50,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            }, 500);
            
            // Detener confeti despu√©s de 5 segundos
            setTimeout(() => {
                clearInterval(intervalo);
            }, 5000);
        }
    </script>
</body>
</html>